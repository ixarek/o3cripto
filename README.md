# o3cripto

Простой пример торгового бота для фьючерсов Bybit.

Реализованные вспомогательные функции находятся в `functions.py`.

## Установка

1. Создайте файл `.env` на основе `.env.example` и заполните его своими API‑ключами Bybit.
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
3. Запустите бота:
   ```bash
   python bot.py
   ```

   Скрипт будет работать постоянно, раз в минуту проверяя торговые сигналы
   и записывая действия в `trade_log.txt`.

Во время работы бот пишет сообщения в текстовый файл `trade_log.txt`,
чтобы можно было проследить историю предыдущих запусков.
Теперь лог содержит значения индикаторов SMA и RSI, итоговый сигнал и
параметры каждой сделки (цена, количество, SL/TP и плечо), что помогает
анализировать поведение стратегий.

Пример получает и выводит баланс счёта в тестовой среде Bybit.
Также он содержит вспомогательные функции для открытия и закрытия рыночных ордеров с плечом на парах
`BTCUSDT`, `ETHUSDT`, `SOLUSDT`, `XRPUSDT`, `DOGEUSDT` и `BNBUSDT`.

## Запуск как сервис (systemd)

Чтобы бот работал без открытой SSH‑сессии, можно оформить его как сервис systemd.

1. Скопируйте файл `o3cripto.service` в `/etc/systemd/system/`:
   ```bash
   sudo cp o3cripto.service /etc/systemd/system/
   ```
2. Перечитайте конфигурацию и запустите сервис:
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable --now o3cripto.service
   ```
3. Логи можно смотреть командой:
   ```bash
   journalctl -u o3cripto.service -f
   ```

Файл сервиса запускает бота командой `/usr/bin/python3 /root/o3cripto/bot.py`
и автоматически перезапускает процесс при сбоях.

## Вспомогательные функции

- `calculate_dynamic_order_size` — размер позиции по балансу и волатильности
- `apply_trailing_stop` — подтягивает стоп-лосс за ценой
- `partial_take_profit` — частичное закрытие позиции по целям
- `limit_open_positions` — ограничение числа одновременных сделок
- `select_strategy` — выбор стратегии из конфигурации
- `dynamic_leverage` — динамическое изменение плеча по волатильности
- `reload_config` — перезагрузка настроек без перезапуска
- `cache_candles` — кэширование последних свечей на диск
- `log_performance_metrics` — логирование задержек API и времени стратегии

- `half_year_strategy` — сигнал, стоп и тейк‑профит по данным за полгода (EMA/RSI/ATR с пересчётом ATR к 5‑минутным свечам)
- `half_year_strategy` — сигнал, стоп и тейк‑профит по данным за полгода (EMA/RSI/ATR)


## Торговые стратегии

В бота встроен пример стратегии пересечения скользящих средних через функцию
`trade_with_signals`, которая открывает позицию только при совпадении сигналов
пересечения скользящих средних (5‑ и 20‑периодных SMA) и RSI.
Функция `half_year_strategy` анализирует 4‑часовые свечи за последние шесть месяцев
и возвращает направление сделки с уровнями SL/TP, вычисленными на основе ATR.

Волатильность пересчитывается к 5‑минутному таймфрейму (ATR ÷ 48), чтобы уровни были
адекватны для внутридневной торговли.

Для автономной работы в 2025 году можно расширить бота следующими методами:

- **Прогнозирование с подкреплением**, обученное на данных ордербука.
- **Статистический арбитраж** на коррелированных парах для поиска неправильного ценообразования.
- **Системы пробоя волатильности** с динамическим управлением рисками.
- **Анализ настроений** из новостей и социальных сетей для фильтрации сделок.

## Тестирование

```bash
pytest --cov=bot
```

Тесты покрывают весь функционал бота, обеспечивая 100% покрытие модулей.

## Стресс-тесты

Шаг **2.5** из roadmap посвящён проверке стратегии в экстремальных
условиях. После обычных бэктестов запустите `stress_tests.py`, чтобы
увидеть, как выбранная логика поведения переживает резкие обвалы.

```bash
python stress_tests.py BTC-USD 2020-03-01 2020-04-01
```

Скрипт использует backtrader и простую стратегию пересечения SMA,
воспроизводя заданный период и выводя итоговый P&L, максимальную
просадку и журнал совершённых ордеров. Укажите любой кризисный
интервал — например, обвал ноября 2022 года или новые события
2025 года — чтобы убедиться, что стратегия остаётся устойчивой.

Стартовый капитал фиксирован на уровне $10 000. Теперь модуль
автоматически подбирает дробный размер позиции, поэтому тесты
корректно работают даже с дорогими активами вроде BTC, тогда как
раньше сделки отклонялись и результат оставался нулевым.


